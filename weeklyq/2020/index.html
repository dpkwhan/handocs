
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Learning is a lifelong journey">
      
      
      
        <meta name="author" content="David Han">
      
      
      <link rel="shortcut icon" href="../../assets/images/profile-pic.jpg">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.7">
    
    
      
        <title>Weekly Kdb/q Questions - David Han</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../assets/css/extra.css">
    
      <link rel="stylesheet" href="../../assets/css/charting.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-140259656-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="deep-orange">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#weekly-kdbq-questions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="David Han" class="md-header-nav__button md-logo" aria-label="David Han">
      
  <img src="../../assets/images/profile-pic.jpg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            David Han
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Weekly Kdb/q Questions
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="David Han" class="md-nav__button md-logo" aria-label="David Han">
      
  <img src="../../assets/images/profile-pic.jpg" alt="logo">

    </a>
    David Han
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../aboutme/" class="md-nav__link">
        About me
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://dpkwhan.github.io/weeklyq/" class="md-nav__link">
        Weekly q
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
      
      <label class="md-nav__link" for="nav-4">
        Julia
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Julia" data-md-level="1">
        <label class="md-nav__title" for="nav-4">
          <span class="md-nav__icon md-icon"></span>
          Julia
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../julia/julia-features-i-like/" class="md-nav__link">
        Julia Features I like
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
      
      <label class="md-nav__link" for="nav-5">
        Python
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Python" data-md-level="1">
        <label class="md-nav__title" for="nav-5">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/a-first-taste-of-pathlib/" class="md-nav__link">
        A First Taste of pathlib
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/evolution-of-string-formatting/" class="md-nav__link">
        Evolution of String Formatting
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
      
      <label class="md-nav__link" for="nav-6">
        JavaScript
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="JavaScript" data-md-level="1">
        <label class="md-nav__title" for="nav-6">
          <span class="md-nav__icon md-icon"></span>
          JavaScript
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/array-concatenation/" class="md-nav__link">
        Array Concatenation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/my-journey-to-web-scraping/" class="md-nav__link">
        My Journey to Web Scraping
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/bubble-chart-in-javascript/" class="md-nav__link">
        Charting Library in JavaScript
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
      
      <label class="md-nav__link" for="nav-7">
        VS Code
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="VS Code" data-md-level="1">
        <label class="md-nav__title" for="nav-7">
          <span class="md-nav__icon md-icon"></span>
          VS Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../vscode/common/common/" class="md-nav__link">
        Common
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../vscode/python/python/" class="md-nav__link">
        Python
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../vscode/javascript/javascript/" class="md-nav__link">
        JavaScript
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
      
      <label class="md-nav__link" for="nav-8">
        Markets
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Markets" data-md-level="1">
        <label class="md-nav__title" for="nav-8">
          <span class="md-nav__icon md-icon"></span>
          Markets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../markets/short-sell-restriction/" class="md-nav__link">
        Short Sell Restriction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../markets/symbology/" class="md-nav__link">
        Equities Market Symbology
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" >
      
      <label class="md-nav__link" for="nav-9">
        Tips
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tips" data-md-level="1">
        <label class="md-nav__title" for="nav-9">
          <span class="md-nav__icon md-icon"></span>
          Tips
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/cron-job/" class="md-nav__link">
        Cron Job
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/vim-color-scheme/" class="md-nav__link">
        Vim Color Scheme
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#20200224" class="md-nav__link">
    2020.02.24
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="weekly-kdbq-questions">Weekly Kdb/q Questions<a class="headerlink" href="#weekly-kdbq-questions" title="Permanent link">&para;</a></h1>
<h2 id="20200224">2020.02.24<a class="headerlink" href="#20200224" title="Permanent link">&para;</a></h2>
<p>Suppose you have an existing dictionary <code>d</code> as follows:</p>
<div class="highlight"><pre><span></span><code>q)d:`firstName`lastName!`Tom`Jerry
q)d
firstName| Tom
lastName | Jerry
</code></pre></div>
<p>Add a new key <code>age</code> with value 37 to this dictionary so that you get:
q)d
firstName| Tom
lastName | Jerry
age      | 37
<div class="highlight"><pre><span></span><code>## 2020.02.17

In the electronic trading world, parameterization is so common that some Algorithms are configured 
with hundreds or thousands of parameters. An algorithmic order can easily has hundreds of parameters 
and some of which are exposed to users so that they can amend the order attibutes. For example, the 
participation rate of a POV (Percent Of Volume) order can be amended by users. A common question 
encountered in the our daily work is which parameters are modified and how it is changed when an 
amend happens.

**Q:** Below is an example history of a few selected parameters of a POV order. Create a table to 
show the parameter history with each parameter name as the column name in the table. You need to 
treat the change in order quantity and/or price limit the same as parameter change.

```q
paramTbl:([]time:`time$();orderQty:`long$();limitPrice:`float$();params:());
`paramTbl insert (09:30:56.123;500000;0n;`StartTime`ParticipationRate!(10:00:00.000;0.08));
`paramTbl insert (09:35:44.735;500000;0n;`StartTime`ParticipationRate!(09:40:00.000;0.08));
`paramTbl insert (10:01:25.941;500000;0n;`StartTime`ParticipationRate`Urgency!(09:40:00.000;0.12;`Medium));
`paramTbl insert (10:10:32.356;500000;0n;`StartTime`ParticipationRate`MinParcipationRate`MaxParcipationRate`Urgency!(09:40:00.000;0.12;0.10;0.14;`Medium));
`paramTbl insert (10:30:39.475;500000;45.23;`StartTime`ParticipationRate`MinParcipationRate`MaxParcipationRate`Urgency!(09:40:00.000;0.12;0.10;0.14;`Medium));
`paramTbl insert (11:00:52.092;600000;45.27;`StartTime`ParticipationRate`MinParcipationRate`MaxParcipationRate`Urgency!(09:40:00.000;0.12;0.10;0.14;`Medium));
`paramTbl insert (11:00:52.092;1000000;0n;`StartTime`ParticipationRate`Urgency!(09:40:00.000;0.15;`Medium));
</code></pre></div></p>
<p>The final output table should look like as follows. Note in kdb table, the empty cell in the table below should have proper null value.</p>
<table>
<thead>
<tr>
<th align="center">time</th>
<th align="center">OrderQty</th>
<th align="center">LimitPrice</th>
<th align="center">StartTime</th>
<th align="center">ParticipationRate</th>
<th align="center">Urgency</th>
<th align="center">MinParcipationRate</th>
<th align="center">MaxParcipationRate</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">09:30:56.123</td>
<td align="center">500000</td>
<td align="center"></td>
<td align="center">10:00:00.000</td>
<td align="center">0.08</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">09:35:44.735</td>
<td align="center">500000</td>
<td align="center"></td>
<td align="center">09:40:00.000</td>
<td align="center">0.08</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">10:01:25.941</td>
<td align="center">500000</td>
<td align="center"></td>
<td align="center">09:40:00.000</td>
<td align="center">0.12</td>
<td align="center">Medium</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">10:10:32.356</td>
<td align="center">500000</td>
<td align="center"></td>
<td align="center">09:40:00.000</td>
<td align="center">0.12</td>
<td align="center">Medium</td>
<td align="center">0.1</td>
<td align="center">0.14</td>
</tr>
<tr>
<td align="center">10:30:39.475</td>
<td align="center">500000</td>
<td align="center">45.23</td>
<td align="center">09:40:00.000</td>
<td align="center">0.12</td>
<td align="center">Medium</td>
<td align="center">0.1</td>
<td align="center">0.14</td>
</tr>
<tr>
<td align="center">11:00:52.092</td>
<td align="center">600000</td>
<td align="center">45.27</td>
<td align="center">09:40:00.000</td>
<td align="center">0.12</td>
<td align="center">Medium</td>
<td align="center">0.1</td>
<td align="center">0.14</td>
</tr>
<tr>
<td align="center">11:00:52.092</td>
<td align="center">1000000</td>
<td align="center"></td>
<td align="center">09:40:00.000</td>
<td align="center">0.15</td>
<td align="center">Medium</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p><strong>A:</strong> The answer below shows a few tips about dictionary manipulation:</p>
<ul>
<li>Use <code>raze</code> to merge multiple dictionaries into a single dictionary</li>
<li>Find the proper null values for each dictionary key</li>
<li>Merge two dictionaries with comma</li>
<li>Merge two tables side by side</li>
</ul>
<div class="highlight"><pre><span></span><code>flattenParams:{[paramTbl]
    / Merge all parameter into a single dictionary so as to get a full list of parameter names
    allParams:raze exec params from paramTbl;

    / Find the null value for each parameter name
    nullValues:(key allParams)!(enlist each value allParams)[;1];

    / Create a table of &quot;parameter&quot; change history of order qty and limit price
    params1:select time,OrderQty:orderQty,LimitPrice:limitPrice from paramTbl;

    / Set a proper null value to parameters that are not present
    params2:exec {x,y}[nullValues;] each params from paramTbl;

    / Combine the normal parameters with the pseudo parameters
    params1,&#39;params2
  };
flattenParams[paramTbl]
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 David Han
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/4.2.1/echarts.min.js"></script>
      
        <script src="https://code.highcharts.com/highcharts.js"></script>
      
        <script src="https://code.highcharts.com/highcharts-more.js"></script>
      
        <script src="https://code.highcharts.com/modules/exporting.js"></script>
      
        <script src="https://code.highcharts.com/modules/export-data.js"></script>
      
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
      
        <script src="../../assets/js/charting.js"></script>
      
        <script src="../../assets/js/finra.ats.js"></script>
      
    
  </body>
</html>